export var stateToSvg = function (document, svgContainer, svgElementsCreator) {
    var oldState;
    var elementsGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
    svgContainer.appendChild(elementsGroup);
    return function (state) {
        var changedElements = state.elements.filter(function (element) {
            if (!oldState) {
                return true;
            }
            var oldElement = oldState.elements.find(function (oldEl) { return oldEl.id === element.id; });
            if (!oldElement) {
                return true;
            }
            return !Object.keys(element).every(function (elementKey) {
                var elementValue = element[elementKey];
                var oldElementValue = oldElement[elementKey];
                return elementValue === oldElementValue;
            });
        });
        var deletedElements = oldState && oldState.elements.filter(function (oldElement) {
            return !state.elements.find(function (element) { return element.id === oldElement.id; });
        });
        var getDomElement = function (element) {
            var domElement = svgElementsCreator(document, element);
            if (element.children) {
                element.children.forEach(function (child) {
                    if (!child.id && child.id !== 0) {
                        throw new Error('Child id are not defined');
                    }
                    if (!child.type) {
                        throw new Error('Child type are not defined');
                    }
                    return domElement.appendChild(svgElementsCreator(document, child));
                });
            }
            return domElement;
        };
        var updateElement = function (element) {
            var children = Array.from(elementsGroup.children);
            var oldElement = children.find(function (childEl) { return element.dataset.id === childEl.getAttribute('data-id'); });
            if (!oldElement) {
                elementsGroup.appendChild(element);
                return;
            }
            elementsGroup.replaceChild(element, oldElement);
        };
        var deleteElement = function (element) {
            var children = Array.from(elementsGroup.children);
            var targetDOMElement = children.find(function (childEl) { return "" + element.id === childEl.getAttribute('data-id'); });
            if (!targetDOMElement) {
                throw new Error('Element to delete not found in DOM');
            }
            elementsGroup.removeChild(targetDOMElement);
        };
        var newDomElements = changedElements.map(getDomElement);
        newDomElements.forEach(updateElement);
        if (deletedElements) {
            deletedElements.forEach(deleteElement);
        }
        oldState = state;
    };
};
export var combineSVGElementCreators = function (props) {
    return function (document, element) {
        if (!props[element.type]) {
            throw new Error("Unknown element type: " + element.type);
        }
        return props[element.type](document, element);
    };
};
//# sourceMappingURL=StateToSvg.js.map