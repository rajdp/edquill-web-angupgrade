var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
export var addElement = function (stateChanger, parameters) {
    return stateChanger(function (state, setState) {
        var lastId = state.elements.length - 1;
        var createElement = function (parameters) {
            if (!parameters.type) {
                throw new Error('Element type is not specified');
            }
            lastId++;
            return {
                id: lastId,
                domId: parameters.domId,
                class: parameters.class,
                type: parameters.type,
                x: parameters.x || 0,
                y: parameters.y || 0,
                width: parameters.width || 0,
                height: parameters.height || 0,
                fill: parameters.fill,
                stroke: parameters.stroke,
                points: parameters.points,
                children: parameters.children,
                text: parameters.text,
                fontSize: parameters.fontSize
            };
        };
        var newElement = createElement(parameters);
        if (newElement.type === 'group') {
            if (!newElement.children) {
                throw new Error('Group children is not specified');
            }
            newElement.children = newElement.children.map(function (element) { return createElement(element); });
        }
        setState({
            elements: __spreadArrays(state.elements, [newElement])
        });
        return newElement;
    });
};
export var setElementParameters = function (stateChanger, parameters) {
    return stateChanger(function (state, setState) {
        if (!parameters.id && parameters.id !== 0) {
            throw new Error('Element id is not specified');
        }
        var targetElement = state.elements.find(function (element) { return element.id === parameters.id; });
        if (!targetElement) {
            throw new Error('Element not found');
        }
        var changedElement = __assign(__assign({}, targetElement), parameters);
        var newStateElements = state.elements.map(function (element) { return (element.id === changedElement.id) ? changedElement : element; });
        setState({
            elements: newStateElements
        });
        return changedElement;
    });
};
export var addElementParameters = function (stateChanger, parameters) {
    return stateChanger(function (state, setState) {
        if (!parameters.id && parameters.id !== 0) {
            throw new Error('Element id is not specified');
        }
        var targetElement = state.elements.find(function (element) { return element.id === parameters.id; });
        if (!targetElement) {
            throw new Error('Element not found');
        }
        var addParameters = function (element, parameters) {
            if (!element.id && element.id !== 0) {
                throw new Error('Element id are not defined');
            }
            if (!element.type) {
                throw new Error('Element type are not defined');
            }
            var changedElement = __assign(__assign(__assign(__assign(__assign(__assign({}, element), { id: element.id, type: element.type }), (parameters.x && element.x && { x: element.x + parameters.x })), (parameters.y && element.y && { y: element.y + parameters.y })), (parameters.width && element.width && { width: element.width + parameters.width })), (parameters.height && element.height && { height: element.height + parameters.height }));
            return changedElement;
        };
        var changedElement = addParameters(targetElement, parameters);
        if (changedElement.children) {
            changedElement.children = changedElement.children.map(function (child) { return addParameters(child, parameters); });
        }
        var newStateElements = state.elements.map(function (element) { return (element.id === changedElement.id) ? changedElement : element; });
        setState({
            elements: newStateElements
        });
        return changedElement;
    });
};
export var removeElement = function (stateChanger, parameters) {
    return stateChanger(function (state, setState) {
        if (typeof parameters.id !== 'number') {
            throw new Error('Element id are not defined');
        }
        var targetElementIndex = state.elements.findIndex(function (element) { return element.id === parameters.id; });
        if (typeof targetElementIndex !== 'number') {
            throw new Error('Element not found');
        }
        var targetElement = state.elements[targetElementIndex];
        var newElements = state.elements.filter(function (_, index) { return index !== targetElementIndex; });
        setState(__assign(__assign({}, state), { elements: newElements }));
        return targetElement;
    });
};
//# sourceMappingURL=Action.js.map