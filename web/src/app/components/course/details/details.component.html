<!-- main body -->
<div class="row">
    <div class="col-xl-12 mb-30">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-6 d-flex align-items-center">
                        <h5 class="px-0">
                            <i class="fa fa-book mr-2"></i>Course Details
                        </h5>
                    </div>
                    <div class="col-6">
                        <div class="float-right">
                            <button class="btn btn-success mr-2" [routerLink]="['/course/wizard']" title="Guided workflow to create Category → Course → Class">
                                <i class="fa fa-magic mr-1"></i> Quick Setup Wizard
                            </button>
                            <button class="btn btn-primary" [routerLink]="['/course/details/add']">
                                <i class="fa fa-plus mr-1"></i> Add Course
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Enhanced Search and Filters -->
                <div class="row mb-3">
                    <div class="col-md-12">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text bg-white">
                                    <i class="fa fa-search text-muted"></i>
                                </span>
                            </div>
                            <input 
                                type="text" 
                                class="form-control" 
                                placeholder="Search courses by name, description, or author..."
                                [(ngModel)]="courseSearchText"
                                (input)="searchCourses()">
                            <div class="input-group-append" *ngIf="courseSearchText">
                                <button class="btn btn-outline-secondary" (click)="clearCourseSearch()">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter Row -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <label class="small font-weight-bold mb-1">
                            <i class="fa fa-folder mr-1"></i> Category
                        </label>
                        <ng-select 
                            [multiple]="true" 
                            placeholder="All Categories" 
                            [(ngModel)]="selectedCategory"
                            [items]="categoryList" 
                            (change)="searchList()"
                            bindLabel="category_name" 
                            bindValue="category_id">
                        </ng-select>
                    </div>
                    <div class="col-md-3">
                        <label class="small font-weight-bold mb-1">
                            <i class="fa fa-tag mr-1"></i> Course Type
                        </label>
                        <ng-select 
                            [multiple]="false" 
                            placeholder="All Types" 
                            [(ngModel)]="selectedCourseType"
                            [items]="courseTypeList" 
                            (change)="searchList()" 
                            [clearable]="false"
                            bindLabel="value" 
                            bindValue="id">
                        </ng-select>
                    </div>
                    <div class="col-md-3">
                        <label class="small font-weight-bold mb-1">
                            <i class="fa fa-flag mr-1"></i> Status
                        </label>
                        <ng-select 
                            [multiple]="true" 
                            placeholder="All Statuses" 
                            [(ngModel)]="selectedStatus"
                            [items]="courseStatus" 
                            (change)="searchList()"
                            bindLabel="value" 
                            bindValue="id">
                        </ng-select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-outline-secondary btn-block" (click)="selectedCategory = []; selectedStatus = []; selectedCourseType = 'All'; searchList();">
                            <i class="fa fa-refresh mr-1"></i> Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="mb-3">
                    <small class="text-muted">
                        <i class="fa fa-info-circle mr-1"></i>
                        Showing {{filteredRows.length}} of {{rows.length}} courses
                    </small>
                </div>

                <!-- Card-Based Course View -->
                <div class="row">
                    <div class="col-md-6 col-lg-4 mb-4" *ngFor="let course of filteredRows">
                        <div class="card h-100 border shadow-sm" style="transition: all 0.2s; position: relative;">
                            <!-- Cover Image -->
                            <div *ngIf="course.path" class="card-img-top" style="height: 180px; overflow: hidden; background: #f5f5f5;">
                                <img 
                                    [src]="env.imgUrl + '/' + course.path" 
                                    class="w-100 h-100"
                                    style="object-fit: cover; cursor: pointer;"
                                    alt="{{course.course_name}}"
                                    (click)="showCourseDetail(course)">
                            </div>
                            
                            <div class="card-body">
                                <!-- Title with Edit Button -->
                                <div class="d-flex align-items-start mb-2">
                                    <button 
                                        class="btn btn-sm btn-outline-primary mr-2 p-1" 
                                        style="width: 30px; height: 30px; flex-shrink: 0;"
                                        (click)="editCourseDetails(course)"
                                        title="Edit course">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <h6 class="mb-0 flex-grow-1 cursor" (click)="showCourseDetail(course)">
                                        <i class="fa fa-book mr-2 text-primary"></i>
                                        {{course.course_name}}
                                    </h6>
                                </div>
                                
                                <!-- Category & Subject -->
                                <div class="mb-2">
                                    <small class="text-muted d-block">
                                        <i class="fa fa-folder mr-1"></i>
                                        <strong>Category:</strong> {{course.category_name?.join(', ') || '---'}}
                                    </small>
                                    <small class="text-muted d-block">
                                        <i class="fa fa-book mr-1"></i>
                                        <strong>Subject:</strong> {{course.subject_name?.join(', ') || '---'}}
                                    </small>
                                </div>
                                
                                <!-- Status & Type Badges -->
                                <div class="mb-3">
                                    <span class="badge badge-success" *ngIf="course.status == 'A'">
                                        <i class="fa fa-check-circle mr-1"></i>Approved
                                    </span>
                                    <span class="badge badge-warning" *ngIf="course.status == 'P'">Ready for Review</span>
                                    <span class="badge badge-secondary" *ngIf="course.status == 'D'">Draft</span>
                                    <span class="badge badge-info" *ngIf="course.status == 'R'">Rework</span>
                                    <span class="badge badge-danger" *ngIf="course.status == 'C'">Cancelled</span>
                                    
                                    <span class="badge badge-primary ml-1" *ngIf="course.is_popular == 'Y'">
                                        <i class="fa fa-star mr-1"></i>Popular
                                    </span>
                                    <span class="badge badge-warning ml-1" *ngIf="course.event == '1'">
                                        <i class="fa fa-calendar mr-1"></i>Webinar
                                    </span>
                                </div>
                                
                                <!-- Fee & Display Order -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="text-muted small">
                                        <i class="fa fa-sort-numeric-up mr-1"></i>
                                        Order: {{course.display_order || '---'}}
                                    </span>
                                    <span class="text-success font-weight-bold" *ngIf="course.fees">
                                        <i class="fa fa-dollar mr-1"></i>{{course.fees}}
                                    </span>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="d-flex gap-2 mb-2">
                                    <ng-container *ngIf="hasLinkedClasses(course); else addClassCta">
                                        <button class="btn btn-sm btn-info flex-fill" (click)="viewClasses(course)">
                                            <i class="fa fa-users mr-1"></i>
                                            View Classes - {{ getCourseClassCountDisplay(course) }}
                                        </button>
                                    </ng-container>
                                    <ng-template #addClassCta>
                                        <button class="btn btn-sm btn-success flex-fill" (click)="addClassForCourse(course)">
                                            <i class="fa fa-plus mr-1"></i> Add Class
                                        </button>
                                    </ng-template>
                                    <button class="btn btn-sm btn-outline-primary" (click)="showCourseDetail(course)">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                </div>
                                
                                <!-- SEO and FAQ Buttons -->
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-success flex-fill" (click)="navigateToSEO(course)">
                                        <i class="fa fa-search mr-1"></i> SEO
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning flex-fill" (click)="navigateToFAQ(course)">
                                        <i class="fa fa-question-circle mr-1"></i> FAQ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Results Messages -->
                <div *ngIf="filteredRows.length === 0 && (courseSearchText || selectedCategory.length > 0 || selectedStatus.length > 0 || selectedCourseType != 'All')" 
                     class="text-center text-muted py-5">
                    <i class="fa fa-search fa-3x mb-3"></i>
                    <p>No courses found matching your search criteria</p>
                    <button class="btn btn-outline-secondary" (click)="courseSearchText = ''; selectedCategory = []; selectedStatus = []; selectedCourseType = 'All'; searchList();">
                        <i class="fa fa-times mr-1"></i> Clear All Filters
                    </button>
                </div>

                <div *ngIf="rows.length === 0" class="text-center text-muted py-5">
                    <i class="fa fa-book fa-3x mb-3"></i>
                    <p class="mb-3">No courses available yet</p>
                    <button class="btn btn-primary" [routerLink]="['/course/details/add']">
                        <i class="fa fa-plus mr-2"></i> Create Your First Course
                    </button>
                </div>

            </div>
        </div>
    </div>

</div>
<ng-template #courseDetail let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h5 class="contenttext text-center mb-0">Course Detail</h5>
        <i class="fa fa fa-times-circle pull-right cursor color-red-icon" aria-hidden="true" (click)="close()"></i>
    </div>
    <div class= "modal-body">
        <div class="container-fluid">
            <div class="row mt-3">
                <div class="col-4">
                    <p>Course Name</p>
                </div>
                <div class="col-8">
                    <p>{{selectedCourseDetail.course_name}}</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Category</p>
                </div>
                <div class="col-8">
                    <span *ngFor="let data of selectedCourseDetail.category_name">{{data}}</span>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Subject</p>
                </div>
                <div class="col-8">
                    <span *ngFor="let data of selectedCourseDetail.subject_name">{{data}}</span>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Short Description</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.short_description == '' ? '---' : selectedCourseDetail.short_description">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Description</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.description == '' ? '---' : selectedCourseDetail.description">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Overview Content</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.overview_content == '' ? '---' : selectedCourseDetail.overview_content">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Course Content</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.course_content == '' ? '---' : selectedCourseDetail.course_content">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Course Pre Requisites</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.prerequisites == '' ? '---' : selectedCourseDetail.prerequisites">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Other Details</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.other_details == '' ? '---' : selectedCourseDetail.other_details">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Lesson</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCourseDetail.lessons == '' ? '---' : selectedCourseDetail.lessons">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Author</p>
                </div>
                <div class="col-8">
                    <p>{{selectedCourseDetail.author == '' ? '---' : selectedCourseDetail.author}}</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Fees</p>
                </div>
                <div class="col-8">
                    <p *ngIf="selectedCourseDetail.author != ''">$ {{selectedCourseDetail.fees}}</p>
                    <p *ngIf="selectedCourseDetail.author == ''">---</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Cover Image</p>
                </div>
                <div class="col-4">
                    <img class="img-thumbnail" src="{{webhost}}{{selectedCourseDetail.path}}"  alt="Cover Image" />
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Status</p>
                </div>
                <div class="col-8">
                    <p><span class="badge badge-success" *ngIf="selectedCourseDetail.status == 'A'">Active</span>
                        <span class="badge badge-danger" *ngIf="selectedCourseDetail.status == 'I'">Suspended</span></p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Certified Course</p>
                </div>
                <div class="col-8">
                    <p>{{selectedCourseDetail.certified_course == 'Y' ? 'Yes' : 'No'}}</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Allow Multiple Schedule Select</p>
                </div>
                <div class="col-8">
                    <p>{{selectedCourseDetail.multiple_schedule == 'Y' ? 'Yes' : 'No'}}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button (click)="editCourseDetails(selectedCourseDetail)" class="btn btn-primary my-1 float-left float-sm-right">Edit Course Detail</button>
    </div>
</ng-template>
