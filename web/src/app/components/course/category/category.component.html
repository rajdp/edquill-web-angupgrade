<!-- main body -->
<div class="row">
    <div class="col-xl-12 mb-30">
        <div class="card">
            <div class="card-header">
                <div class="row align-items-center">
                    <div class="col">
                        <h5 class="px-0 mb-0">
                            <i class="fa fa-folder mr-2"></i>Course Category List
                        </h5>
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-success mr-2" [routerLink]="['/course/wizard']" title="Guided workflow to create Category → Course → Class">
                            <i class="fa fa-magic mr-1"></i> Quick Setup Wizard
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Enhanced Search Bar -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text bg-white">
                                    <i class="fa fa-search text-muted"></i>
                                </span>
                            </div>
                            <input 
                                (input)="searchFunction()" 
                                type="text" 
                                class="form-control" 
                                placeholder="Search categories by name or description..."
                                [(ngModel)]="searchedValue">
                            <div class="input-group-append" *ngIf="searchedValue">
                                <button class="btn btn-outline-secondary" (click)="clearSearch()">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 text-right">
                        <button class="btn btn-primary" [routerLink]="['/course/category/add']">
                            <i class="fa fa-plus mr-2"></i> Add Course Category
                        </button>
                    </div>
                </div>

                <!-- Card-Based View -->
                <div class="row">
                    <div class="col-md-6 col-lg-4 mb-4" *ngFor="let category of filteredCategoryList">
                        <div class="card h-100 border category-card shadow-sm" style="transition: all 0.2s; position: relative;">
                            <div class="card-body">
                                <!-- Title with Edit Button -->
                                <div class="d-flex align-items-center mb-3">
                                    <button 
                                        class="btn btn-sm btn-outline-primary mr-2 p-1" 
                                        style="width: 30px; height: 30px;"
                                        (click)="getEditcourse(category)"
                                        title="Edit this category">
                                        <i class="fa fa-pencil"></i>
                                    </button>
                                    <h5 class="mb-0 flex-grow-1">
                                        <i class="fa fa-folder mr-2 text-primary"></i>
                                        <span class="cursor" (click)="showCategoryList(category)">{{category.category_name}}</span>
                                    </h5>
                                </div>
                                
                                <!-- Cover Image -->
                                <div class="mb-3" *ngIf="category.path">
                                    <img 
                                        [src]="env.imgUrl + '/' + category.path" 
                                        class="img-fluid rounded"
                                        style="max-height: 150px; width: 100%; object-fit: cover;"
                                        alt="{{category.category_name}}"
                                        (click)="showCategoryList(category)"
                                        style="cursor: pointer;">
                                </div>
                                
                                <!-- Description -->
                                <p class="text-muted small mb-3" 
                                   *ngIf="category.description" 
                                   [innerHTML]="category.description | truncateHtml : 100"
                                   (click)="showCategoryList(category)"
                                   style="cursor: pointer; min-height: 40px;">
                                </p>
                                
                                <!-- Info Badges -->
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    <span class="badge badge-secondary">
                                        <i class="fa fa-sort-numeric-up mr-1"></i>Order: {{category.display_order}}
                                    </span>
                                    <span class="badge" 
                                          [class.badge-success]="category.course_count > 0"
                                          [class.badge-light]="category.course_count === 0">
                                        <i class="fa fa-book mr-1"></i>
                                        {{category.course_count || 0}} Course{{category.course_count !== 1 ? 's' : ''}}
                                    </span>
                                    <span class="badge badge-success ml-auto" *ngIf="category.status == 'A'">
                                        <i class="fa fa-check-circle mr-1"></i>Active
                                    </span>
                                    <span class="badge badge-danger ml-auto" *ngIf="category.status == 'I'">
                                        <i class="fa fa-ban mr-1"></i>Inactive
                                    </span>
                                </div>
                                
                                <!-- Action Button -->
                                <div class="mt-3 pt-3 border-top">
                                    <button class="btn btn-sm btn-outline-info btn-block" (click)="showCategoryList(category)">
                                        <i class="fa fa-eye mr-1"></i> View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Results Messages -->
                <div *ngIf="filteredCategoryList.length === 0 && searchedValue" class="text-center text-muted py-5">
                    <i class="fa fa-search fa-3x mb-3"></i>
                    <p>No categories found matching "{{searchedValue}}"</p>
                    <button class="btn btn-outline-secondary" (click)="clearSearch()">
                        <i class="fa fa-times mr-1"></i> Clear Search
                    </button>
                </div>

                <div *ngIf="categoryListData.length === 0 && !searchedValue" class="text-center text-muted py-5">
                    <i class="fa fa-folder-open fa-3x mb-3"></i>
                    <p class="mb-3">No categories available yet</p>
                    <button class="btn btn-primary" [routerLink]="['/course/category/add']">
                        <i class="fa fa-plus mr-2"></i> Create Your First Category
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<ng-template #categoryViewList let-c="close" let-d="dismiss">
    <div class="modal-header align-items-center">
        <h5 class="contenttext text-center mb-0">Course Category</h5>
        <i class="fa fa fa-times-circle pull-right cursor color-red-icon" aria-hidden="true" (click)="close()"></i>
    </div>
    <div class= "modal-body">
        <div class="container-fluid">
            <div class="row mt-3">
                <div class="col-4">
                    <p>Category Name</p>
                </div>
                <div class="col-8">
                    <p>{{selectedCategoryList.category_name}}</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Description</p>
                </div>
                <div class="col-8" [innerHTML]="selectedCategoryList.description == '' ? '---' : selectedCategoryList.description">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Cover Image</p>
                </div>
                <div class="col-4">
                    <img class="img-thumbnail" src="{{env.imgUrl}}{{selectedCategoryList.path}}"  alt="Cover Image" />
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-4">
                    <p>Status</p>
                </div>
                <div class="col-8">
                    <p><span class="badge badge-success" *ngIf="selectedCategoryList.status == 'A'">Active</span>
                        <span class="badge badge-danger" *ngIf="selectedCategoryList.status == 'I'">Suspended</span></p>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button (click)="getEditcourse(selectedCategoryList)" class="btn btn-primary my-1 float-left float-sm-right">Edit Course Category</button>
    </div>
</ng-template>
