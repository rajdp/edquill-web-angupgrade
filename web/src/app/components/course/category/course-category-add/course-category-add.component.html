<section>
    <div class="container-fluid">
        <div class="card">
            <!-- Header -->
            <div class="card-header py-3" [class.bg-light]="!isWizardMode" [class.bg-info]="isWizardMode" [class.text-white]="isWizardMode">
                <div class="row align-items-center">
                    <div class="col">
                        <div *ngIf="isWizardMode" class="badge badge-warning mb-2">
                            <i class="fa fa-magic mr-1"></i> Wizard Mode
                        </div>
                        <h5 class="mb-1" [class.text-primary]="!isWizardMode" [class.text-white]="isWizardMode">
                            <i class="fa fa-folder mr-2"></i>
                            {{type == 'add' ? 'Add New' : 'Update'}} Category
                        </h5>
                        <p class="mb-0 small" [class.text-muted]="!isWizardMode" [class.text-white-50]="isWizardMode">
                            <i class="fa fa-info-circle mr-1"></i>
                            Fields marked with <span class="font-weight-bold" [class.text-danger]="!isWizardMode" [class.text-warning]="isWizardMode">*</span> are required
                        </p>
                    </div>
                    <div class="col-auto">
                        <a *ngIf="!isWizardMode" class="btn btn-outline-secondary btn-sm" routerLink="/course/category/list">
                            <i class="fa fa-arrow-left mr-1"></i> Back to List
                        </a>
                        <button *ngIf="isWizardMode" class="btn btn-outline-light btn-sm" (click)="returnToWizard()">
                            <i class="fa fa-magic mr-1"></i> Back to Wizard
                        </button>
                    </div>
                </div>
            </div>

            <!-- Form Body -->
            <div class="card-body">
                <form [formGroup]="form">
                    
                    <!-- Basic Information Section -->
                    <div class="mb-4">
                        <h6 class="text-secondary mb-3 pb-2 border-bottom">
                            <i class="fa fa-info-circle mr-2"></i>Basic Information
                        </h6>

                        <!-- Category Name -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                <span class="text-danger mr-1">*</span>Category Name
                            </label>
                            <div class="col-sm-9 col-md-10">
                                <input 
                                    type="text"
                                    class="form-control" 
                                    formControlName="category_name" 
                                    placeholder="Enter category name (e.g., AP Calculus, Grade 6 Math)">
                                <em *ngIf="!form.get('category_name').valid && (form.get('category_name').dirty || form.get('category_name').touched)"
                                    class="error d-block mt-1">
                                    <i class="fa fa-exclamation-circle mr-1"></i>Category name is required
                                </em>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                Description
                            </label>
                            <div class="col-sm-9 col-md-10">
                                <app-tiny-mice 
                                    [height]="250" 
                                    [editorPatchValue]="type == 'add' ? false : description"
                                    (emitEditorValue)="editorValue($event)"
                                    [hideMatEditor]="true">
                                </app-tiny-mice>
                                <small class="form-text text-muted">
                                    <i class="fa fa-lightbulb mr-1"></i>Provide a brief description of this category (optional)
                                </small>
                            </div>
                        </div>

                        <!-- Subject Selection -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                Subject(s)
                            </label>
                            <div class="col-sm-9 col-md-10">
                                <ng-select
                                    [items]="subjectList"
                                    bindLabel="subject_name"
                                    bindValue="subject_id"
                                    formControlName="subject_id"
                                    placeholder="Select one or more subjects"
                                    [multiple]="true"
                                    [clearable]="true">
                                </ng-select>
                                <small class="form-text text-muted">
                                    <i class="fa fa-book mr-1"></i>Select subjects associated with this category (optional)
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Display Settings Section -->
                    <div class="mb-4">
                        <h6 class="text-secondary mb-3 pb-2 border-bottom">
                            <i class="fa fa-cog mr-2"></i>Display Settings
                        </h6>

                        <!-- Display Order -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                <span class="text-danger mr-1">*</span>Display Order
                            </label>
                            <div class="col-sm-9 col-md-10 col-lg-4">
                                <input 
                                    type="text"
                                    maxlength="4" 
                                    (keypress)="numberValidate($event)" 
                                    class="form-control"
                                    formControlName="display_order"
                                    placeholder="e.g., 1, 2, 3...">
                                <small class="form-text text-muted">
                                    <i class="fa fa-sort-numeric-up mr-1"></i>Lower numbers appear first in the list
                                </small>
                                <em *ngIf="!form.get('display_order').valid && (form.get('display_order').dirty || form.get('display_order').touched)"
                                    class="error d-block mt-1">
                                    <i class="fa fa-exclamation-circle mr-1"></i>Display order is required
                                </em>
                                <em *ngIf="showErrorMessage()" class="error d-block mt-1">
                                    <i class="fa fa-exclamation-circle mr-1"></i>{{showErrorMessage()}}
                                </em>
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                Status
                            </label>
                            <div class="col-sm-9 col-md-10 col-lg-4">
                                <select class="form-control" formControlName="status">
                                    <option value="A">
                                        <i class="fa fa-check-circle"></i> Active
                                    </option>
                                    <option value="I">
                                        <i class="fa fa-pause-circle"></i> Inactive
                                    </option>
                                </select>
                                <small class="form-text text-muted">
                                    <i class="fa fa-toggle-on mr-1"></i>Active categories are visible to users
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Media Section -->
                    <div class="mb-4">
                        <h6 class="text-secondary mb-3 pb-2 border-bottom">
                            <i class="fa fa-image mr-2"></i>Cover Image
                        </h6>

                        <!-- Image Upload -->
                        <div class="form-group row mb-3">
                            <label class="col-sm-3 col-md-2 col-form-label font-weight-bold">
                                Cover Image
                            </label>
                            <div class="col-sm-9 col-md-10">
                                <div class="custom-file" *ngIf="imagePath == ''">
                                    <input 
                                        #myInput 
                                        type="file"
                                        class="custom-file-input" 
                                        id="coverImage"
                                        (change)="encodeImageFileAsURL($event)" 
                                        accept=".png, .jpg, .jpeg, .webp">
                                    <label class="custom-file-label" for="coverImage">
                                        Choose image file...
                                    </label>
                                </div>
                                <small class="form-text text-muted">
                                    <i class="fa fa-file-image mr-1"></i>
                                    Accepted formats: PNG, JPG, JPEG, WebP | Maximum size: 1MB
                                </small>

                                <!-- Image Preview -->
                                <div class="mt-3" *ngIf="imagePath != ''">
                                    <div class="position-relative d-inline-block">
                                        <img 
                                            [src]="sanitizer.bypassSecurityTrustResourceUrl(webhost  + '/' + imagePath)" 
                                            class="img-thumbnail"
                                            style="max-width: 300px; max-height: 200px;"
                                            alt="Category cover image">
                                        <button 
                                            type="button"
                                            (click)="deleteImg()" 
                                            class="btn btn-danger btn-sm position-absolute"
                                            style="top: 5px; right: 5px;"
                                            title="Remove image">
                                            <i class="fa fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-success">
                                            <i class="fa fa-check-circle mr-1"></i>Image uploaded successfully
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>

            <!-- Footer Actions -->
            <div class="card-footer bg-light">
                <div class="row">
                    <div class="col">
                        <button *ngIf="isWizardMode" class="btn btn-outline-info" (click)="returnToWizard()">
                            <i class="fa fa-magic mr-1"></i> Return to Wizard
                        </button>
                        <a *ngIf="!isWizardMode" class="btn btn-outline-secondary" routerLink="/course/category/list">
                            <i class="fa fa-times mr-1"></i> Cancel
                        </a>
                    </div>
                    <div class="col text-right">
                        <button 
                            class="btn btn-primary px-4"
                            (click)="addcategory()">
                            <i class="fa fa-{{categoryId == '' ? 'plus' : 'save'}} mr-2"></i>
                            {{categoryId == '' ? 'Create' : 'Update'}} Category
                            <span *ngIf="isWizardMode"> & Continue</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
